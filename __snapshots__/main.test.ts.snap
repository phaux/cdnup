export const snapshot = {};

snapshot[`finds updates 1`] = `
{
  errors: Set(1) {
    {
      error: "Fetching https://libs.example.com/unknown/mod.js failed: 404 ",
      filePath: "src/foo.js",
      url: "https://libs.example.com/unknown@1.0.0/mod.js",
    },
  },
  result: {
    updates: Set(10) {
      {
        filePath: "src/App.jsx",
        index: {
          end: 61,
          start: 24,
        },
        location: {
          column: 24,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/react",
          currentUrl: "https://libs.example.com/react@17.0.2",
          currentVersion: {
            index: {
              end: 37,
              start: 30,
            },
            major: 17,
            match: "@17.0.2",
            minor: 0,
            patch: 2,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/react@19.1.1",
          latestVersion: {
            index: {
              end: 37,
              start: 30,
            },
            major: 19,
            match: "@19.1.1",
            minor: 1,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/App.tsx",
        index: {
          end: 62,
          start: 24,
        },
        location: {
          column: 24,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/preact",
          currentUrl: "https://libs.example.com/preact@10.0.0",
          currentVersion: {
            index: {
              end: 38,
              start: 31,
            },
            major: 10,
            match: "@10.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/preact@10.10.10",
          latestVersion: {
            index: {
              end: 40,
              start: 31,
            },
            major: 10,
            match: "@10.10.10",
            minor: 10,
            patch: 10,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
      {
        filePath: "src/bar.ts",
        index: {
          end: 102,
          start: 61,
        },
        location: {
          column: 8,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/bar.ts",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@2.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 2,
            match: "@2.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/foo.js",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 169,
          start: 108,
        },
        location: {
          column: 29,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4.5/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 38,
              start: 34,
            },
            major: 4,
            match: "@4.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 67,
          start: 13,
        },
        location: {
          column: 13,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/jquery/dist/jquery.min.js",
          currentUrl: "https://libs.example.com/jquery@3.5/dist/jquery.min.js",
          currentVersion: {
            index: {
              end: 35,
              start: 31,
            },
            major: 3,
            match: "@3.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/jquery@3.6.0/dist/jquery.min.js",
          latestVersion: {
            index: {
              end: 37,
              start: 31,
            },
            major: 3,
            match: "@3.6.0",
            minor: 6,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
      {
        filePath: "static/style.css",
        index: {
          end: 68,
          start: 9,
        },
        location: {
          column: 9,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 36,
              start: 34,
            },
            major: 4,
            match: "@4",
            minor: null,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "tasks.json",
        index: {
          end: 65,
          start: 21,
        },
        location: {
          column: 21,
          line: 0,
        },
        update: {
          baseUrl: "https://mods.example.com/x/example/mod.ts",
          currentUrl: "https://mods.example.com/x/example@v1/mod.ts",
          currentVersion: {
            index: {
              end: 37,
              start: 34,
            },
            major: 1,
            match: "@v1",
            minor: null,
            patch: null,
            prefix: "v",
            prerelease: null,
          },
          latestUrl: "https://mods.example.com/x/example@v2.0.0/mod.ts",
          latestVersion: {
            index: {
              end: 41,
              start: 34,
            },
            major: 2,
            match: "@v2.0.0",
            minor: 0,
            patch: 0,
            prefix: "v",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "tasks.yml",
        index: {
          end: 60,
          start: 16,
        },
        location: {
          column: 16,
          line: 0,
        },
        update: {
          baseUrl: "https://mods.example.com/x/example/mod.ts",
          currentUrl: "https://mods.example.com/x/example@v2/mod.ts",
          currentVersion: {
            index: {
              end: 37,
              start: 34,
            },
            major: 2,
            match: "@v2",
            minor: null,
            patch: null,
            prefix: "v",
            prerelease: null,
          },
          latestUrl: "https://mods.example.com/x/example@v2.0.0/mod.ts",
          latestVersion: {
            index: {
              end: 41,
              start: 34,
            },
            major: 2,
            match: "@v2.0.0",
            minor: 0,
            patch: 0,
            prefix: "v",
            prerelease: null,
          },
          release: "minor",
        },
      },
    },
  },
}
`;

snapshot[`writes updates 1`] = `
{
  content: {
    "help.md": [
      "Check out [lib](https://libs.example.com/lib@1.0.0/mod.js).",
    ],
    "help.txt": [
      "Check out https://libs.example.com/lib@1.0.0/mod.js.",
    ],
    "tasks.ini": [
      'start="deno run https://mods.example.com/x/example@v1.2.3/mod.ts"',
    ],
    "tasks.json": [
      '{ "start": "deno run https://mods.example.com/x/example@v2.0.0/mod.ts" }',
    ],
    "tasks.yml": [
      "start: deno run https://mods.example.com/x/example@v2.0.0/mod.ts",
    ],
    node_modules: {
      "foo.js": [
        'import "https://libs.example.com/lib@1.0.0/mod.js";',
      ],
    },
    src: {
      "App.jsx": [
        'import * as React from "https://libs.example.com/react@19.1.1";',
      ],
      "App.tsx": [
        'import * as React from "https://libs.example.com/preact@10.10.10";',
      ],
      "bar.ts": [
        'import("https://libs.example.com/lib@3.2.1/mod.js");',
        'import("https://libs.example.com/lib@3.2.1/mod.js");',
      ],
      "foo.js": [
        'import "https://libs.example.com/lib@3.2.1/mod.js";',
        'import "https://libs.example.com/unknown@1.0.0/mod.js";',
      ],
    },
    static: {
      "page.html": [
        '<script src="https://libs.example.com/jquery@3.6.0/dist/jquery.min.js"></script>',
        '<link rel="stylesheet" href="https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css">',
        '<img src="https://cdn.example.com/dist/img/logo.png" alt="Logo">',
      ],
      "style.css": [
        '@import "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css";',
        "header { background-image: url('https://cdn.example.com/dist/img/logo.jpg'); }",
      ],
    },
  },
  errors: Set(1) {
    {
      error: "Fetching https://libs.example.com/unknown/mod.js failed: 404 ",
      filePath: "src/foo.js",
      url: "https://libs.example.com/unknown@1.0.0/mod.js",
    },
  },
  result: {
    updates: Set(10) {
      {
        filePath: "src/App.jsx",
        index: {
          end: 61,
          start: 24,
        },
        location: {
          column: 24,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/react",
          currentUrl: "https://libs.example.com/react@17.0.2",
          currentVersion: {
            index: {
              end: 37,
              start: 30,
            },
            major: 17,
            match: "@17.0.2",
            minor: 0,
            patch: 2,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/react@19.1.1",
          latestVersion: {
            index: {
              end: 37,
              start: 30,
            },
            major: 19,
            match: "@19.1.1",
            minor: 1,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/App.tsx",
        index: {
          end: 62,
          start: 24,
        },
        location: {
          column: 24,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/preact",
          currentUrl: "https://libs.example.com/preact@10.0.0",
          currentVersion: {
            index: {
              end: 38,
              start: 31,
            },
            major: 10,
            match: "@10.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/preact@10.10.10",
          latestVersion: {
            index: {
              end: 40,
              start: 31,
            },
            major: 10,
            match: "@10.10.10",
            minor: 10,
            patch: 10,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
      {
        filePath: "src/bar.ts",
        index: {
          end: 102,
          start: 61,
        },
        location: {
          column: 8,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/bar.ts",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@2.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 2,
            match: "@2.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/foo.js",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 169,
          start: 108,
        },
        location: {
          column: 29,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4.5/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 38,
              start: 34,
            },
            major: 4,
            match: "@4.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 67,
          start: 13,
        },
        location: {
          column: 13,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/jquery/dist/jquery.min.js",
          currentUrl: "https://libs.example.com/jquery@3.5/dist/jquery.min.js",
          currentVersion: {
            index: {
              end: 35,
              start: 31,
            },
            major: 3,
            match: "@3.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/jquery@3.6.0/dist/jquery.min.js",
          latestVersion: {
            index: {
              end: 37,
              start: 31,
            },
            major: 3,
            match: "@3.6.0",
            minor: 6,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
      {
        filePath: "static/style.css",
        index: {
          end: 68,
          start: 9,
        },
        location: {
          column: 9,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 36,
              start: 34,
            },
            major: 4,
            match: "@4",
            minor: null,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "tasks.json",
        index: {
          end: 65,
          start: 21,
        },
        location: {
          column: 21,
          line: 0,
        },
        update: {
          baseUrl: "https://mods.example.com/x/example/mod.ts",
          currentUrl: "https://mods.example.com/x/example@v1/mod.ts",
          currentVersion: {
            index: {
              end: 37,
              start: 34,
            },
            major: 1,
            match: "@v1",
            minor: null,
            patch: null,
            prefix: "v",
            prerelease: null,
          },
          latestUrl: "https://mods.example.com/x/example@v2.0.0/mod.ts",
          latestVersion: {
            index: {
              end: 41,
              start: 34,
            },
            major: 2,
            match: "@v2.0.0",
            minor: 0,
            patch: 0,
            prefix: "v",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "tasks.yml",
        index: {
          end: 60,
          start: 16,
        },
        location: {
          column: 16,
          line: 0,
        },
        update: {
          baseUrl: "https://mods.example.com/x/example/mod.ts",
          currentUrl: "https://mods.example.com/x/example@v2/mod.ts",
          currentVersion: {
            index: {
              end: 37,
              start: 34,
            },
            major: 2,
            match: "@v2",
            minor: null,
            patch: null,
            prefix: "v",
            prerelease: null,
          },
          latestUrl: "https://mods.example.com/x/example@v2.0.0/mod.ts",
          latestVersion: {
            index: {
              end: 41,
              start: 34,
            },
            major: 2,
            match: "@v2.0.0",
            minor: 0,
            patch: 0,
            prefix: "v",
            prerelease: null,
          },
          release: "minor",
        },
      },
    },
  },
}
`;

snapshot[`finds updates in single dir 1`] = `
{
  errors: Set(1) {
    {
      error: "Fetching https://libs.example.com/unknown/mod.js failed: 404 ",
      filePath: "src/foo.js",
      url: "https://libs.example.com/unknown@1.0.0/mod.js",
    },
  },
  result: {
    updates: Set(5) {
      {
        filePath: "src/App.jsx",
        index: {
          end: 61,
          start: 24,
        },
        location: {
          column: 24,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/react",
          currentUrl: "https://libs.example.com/react@17.0.2",
          currentVersion: {
            index: {
              end: 37,
              start: 30,
            },
            major: 17,
            match: "@17.0.2",
            minor: 0,
            patch: 2,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/react@19.1.1",
          latestVersion: {
            index: {
              end: 37,
              start: 30,
            },
            major: 19,
            match: "@19.1.1",
            minor: 1,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/App.tsx",
        index: {
          end: 62,
          start: 24,
        },
        location: {
          column: 24,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/preact",
          currentUrl: "https://libs.example.com/preact@10.0.0",
          currentVersion: {
            index: {
              end: 38,
              start: 31,
            },
            major: 10,
            match: "@10.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/preact@10.10.10",
          latestVersion: {
            index: {
              end: 40,
              start: 31,
            },
            major: 10,
            match: "@10.10.10",
            minor: 10,
            patch: 10,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
      {
        filePath: "src/bar.ts",
        index: {
          end: 102,
          start: 61,
        },
        location: {
          column: 8,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/bar.ts",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@2.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 2,
            match: "@2.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/foo.js",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
    },
  },
}
`;

snapshot[`writes updates in single dir 1`] = `
{
  content: {
    "help.md": [
      "Check out [lib](https://libs.example.com/lib@1.0.0/mod.js).",
    ],
    "help.txt": [
      "Check out https://libs.example.com/lib@1.0.0/mod.js.",
    ],
    "tasks.ini": [
      'start="deno run https://mods.example.com/x/example@v1.2.3/mod.ts"',
    ],
    "tasks.json": [
      '{ "start": "deno run https://mods.example.com/x/example@v1/mod.ts" }',
    ],
    "tasks.yml": [
      "start: deno run https://mods.example.com/x/example@v2/mod.ts",
    ],
    node_modules: {
      "foo.js": [
        'import "https://libs.example.com/lib@1.0.0/mod.js";',
      ],
    },
    src: {
      "App.jsx": [
        'import * as React from "https://libs.example.com/react@17.0.2";',
      ],
      "App.tsx": [
        'import * as React from "https://libs.example.com/preact@10.0.0";',
      ],
      "bar.ts": [
        'import("https://libs.example.com/lib@2.0.0/mod.js");',
        'import("https://libs.example.com/lib@1.0.0/mod.js");',
      ],
      "foo.js": [
        'import "https://libs.example.com/lib@1.0.0/mod.js";',
        'import "https://libs.example.com/unknown@1.0.0/mod.js";',
      ],
    },
    static: {
      "page.html": [
        '<script src="https://libs.example.com/jquery@3.6.0/dist/jquery.min.js"></script>',
        '<link rel="stylesheet" href="https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css">',
        '<img src="https://cdn.example.com/dist/img/logo.png" alt="Logo">',
      ],
      "style.css": [
        '@import "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css";',
        "header { background-image: url('https://cdn.example.com/dist/img/logo.jpg'); }",
      ],
    },
  },
  errors: Set(0) {},
  result: {
    updates: Set(3) {
      {
        filePath: "static/page.html",
        index: {
          end: 169,
          start: 108,
        },
        location: {
          column: 29,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4.5/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 38,
              start: 34,
            },
            major: 4,
            match: "@4.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 67,
          start: 13,
        },
        location: {
          column: 13,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/jquery/dist/jquery.min.js",
          currentUrl: "https://libs.example.com/jquery@3.5/dist/jquery.min.js",
          currentVersion: {
            index: {
              end: 35,
              start: 31,
            },
            major: 3,
            match: "@3.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/jquery@3.6.0/dist/jquery.min.js",
          latestVersion: {
            index: {
              end: 37,
              start: 31,
            },
            major: 3,
            match: "@3.6.0",
            minor: 6,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
      {
        filePath: "static/style.css",
        index: {
          end: 68,
          start: 9,
        },
        location: {
          column: 9,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 36,
              start: 34,
            },
            major: 4,
            match: "@4",
            minor: null,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
    },
  },
}
`;

snapshot[`find updates in single file 1`] = `
{
  errors: Set(0) {},
  result: {
    updates: Set(2) {
      {
        filePath: "static/page.html",
        index: {
          end: 169,
          start: 108,
        },
        location: {
          column: 29,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4.5/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 38,
              start: 34,
            },
            major: 4,
            match: "@4.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 67,
          start: 13,
        },
        location: {
          column: 13,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/jquery/dist/jquery.min.js",
          currentUrl: "https://libs.example.com/jquery@3.5/dist/jquery.min.js",
          currentVersion: {
            index: {
              end: 35,
              start: 31,
            },
            major: 3,
            match: "@3.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/jquery@3.6.0/dist/jquery.min.js",
          latestVersion: {
            index: {
              end: 37,
              start: 31,
            },
            major: 3,
            match: "@3.6.0",
            minor: 6,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
    },
  },
}
`;

snapshot[`find updates in single file 2`] = `
{
  errors: Set(0) {},
  result: {
    updates: Set(1) {
      {
        filePath: "help.txt",
        index: {
          end: 51,
          start: 10,
        },
        location: {
          column: 10,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
    },
  },
}
`;

snapshot[`writes updates in single file 1`] = `
{
  content: {
    "help.md": [
      "Check out [lib](https://libs.example.com/lib@1.0.0/mod.js).",
    ],
    "help.txt": [
      "Check out https://libs.example.com/lib@1.0.0/mod.js.",
    ],
    "tasks.ini": [
      'start="deno run https://mods.example.com/x/example@v1.2.3/mod.ts"',
    ],
    "tasks.json": [
      '{ "start": "deno run https://mods.example.com/x/example@v1/mod.ts" }',
    ],
    "tasks.yml": [
      "start: deno run https://mods.example.com/x/example@v2/mod.ts",
    ],
    node_modules: {
      "foo.js": [
        'import "https://libs.example.com/lib@1.0.0/mod.js";',
      ],
    },
    src: {
      "App.jsx": [
        'import * as React from "https://libs.example.com/react@17.0.2";',
      ],
      "App.tsx": [
        'import * as React from "https://libs.example.com/preact@10.0.0";',
      ],
      "bar.ts": [
        'import("https://libs.example.com/lib@2.0.0/mod.js");',
        'import("https://libs.example.com/lib@1.0.0/mod.js");',
      ],
      "foo.js": [
        'import "https://libs.example.com/lib@3.2.1/mod.js";',
        'import "https://libs.example.com/unknown@1.0.0/mod.js";',
      ],
    },
    static: {
      "page.html": [
        '<script src="https://libs.example.com/jquery@3.5/dist/jquery.min.js"></script>',
        '<link rel="stylesheet" href="https://libs.example.com/bootstrap@4.5/dist/bootstrap.min.css">',
        '<img src="https://cdn.example.com/dist/img/logo.png" alt="Logo">',
      ],
      "style.css": [
        '@import "https://libs.example.com/bootstrap@4/dist/bootstrap.min.css";',
        "header { background-image: url('https://cdn.example.com/dist/img/logo.jpg'); }",
      ],
    },
  },
  errors: Set(1) {
    {
      error: "Fetching https://libs.example.com/unknown/mod.js failed: 404 ",
      filePath: "src/foo.js",
      url: "https://libs.example.com/unknown@1.0.0/mod.js",
    },
  },
  result: {
    updates: Set(1) {
      {
        filePath: "src/foo.js",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
    },
  },
}
`;

snapshot[`finds updates in multiple dirs 1`] = `
{
  errors: Set(1) {
    {
      error: "Fetching https://libs.example.com/unknown/mod.js failed: 404 ",
      filePath: "src/foo.js",
      url: "https://libs.example.com/unknown@1.0.0/mod.js",
    },
  },
  result: {
    updates: Set(8) {
      {
        filePath: "src/App.jsx",
        index: {
          end: 61,
          start: 24,
        },
        location: {
          column: 24,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/react",
          currentUrl: "https://libs.example.com/react@17.0.2",
          currentVersion: {
            index: {
              end: 37,
              start: 30,
            },
            major: 17,
            match: "@17.0.2",
            minor: 0,
            patch: 2,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/react@19.1.1",
          latestVersion: {
            index: {
              end: 37,
              start: 30,
            },
            major: 19,
            match: "@19.1.1",
            minor: 1,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/App.tsx",
        index: {
          end: 62,
          start: 24,
        },
        location: {
          column: 24,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/preact",
          currentUrl: "https://libs.example.com/preact@10.0.0",
          currentVersion: {
            index: {
              end: 38,
              start: 31,
            },
            major: 10,
            match: "@10.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/preact@10.10.10",
          latestVersion: {
            index: {
              end: 40,
              start: 31,
            },
            major: 10,
            match: "@10.10.10",
            minor: 10,
            patch: 10,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
      {
        filePath: "src/bar.ts",
        index: {
          end: 102,
          start: 61,
        },
        location: {
          column: 8,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/bar.ts",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@2.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 2,
            match: "@2.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/foo.js",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 169,
          start: 108,
        },
        location: {
          column: 29,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4.5/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 38,
              start: 34,
            },
            major: 4,
            match: "@4.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 67,
          start: 13,
        },
        location: {
          column: 13,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/jquery/dist/jquery.min.js",
          currentUrl: "https://libs.example.com/jquery@3.5/dist/jquery.min.js",
          currentVersion: {
            index: {
              end: 35,
              start: 31,
            },
            major: 3,
            match: "@3.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/jquery@3.6.0/dist/jquery.min.js",
          latestVersion: {
            index: {
              end: 37,
              start: 31,
            },
            major: 3,
            match: "@3.6.0",
            minor: 6,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
      {
        filePath: "static/style.css",
        index: {
          end: 68,
          start: 9,
        },
        location: {
          column: 9,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 36,
              start: 34,
            },
            major: 4,
            match: "@4",
            minor: null,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
    },
  },
}
`;

snapshot[`writes updates in multiple dirs 1`] = `
{
  content: {
    "help.md": [
      "Check out [lib](https://libs.example.com/lib@1.0.0/mod.js).",
    ],
    "help.txt": [
      "Check out https://libs.example.com/lib@1.0.0/mod.js.",
    ],
    "tasks.ini": [
      'start="deno run https://mods.example.com/x/example@v1.2.3/mod.ts"',
    ],
    "tasks.json": [
      '{ "start": "deno run https://mods.example.com/x/example@v1/mod.ts" }',
    ],
    "tasks.yml": [
      "start: deno run https://mods.example.com/x/example@v2/mod.ts",
    ],
    node_modules: {
      "foo.js": [
        'import "https://libs.example.com/lib@1.0.0/mod.js";',
      ],
    },
    src: {
      "App.jsx": [
        'import * as React from "https://libs.example.com/react@19.1.1";',
      ],
      "App.tsx": [
        'import * as React from "https://libs.example.com/preact@10.10.10";',
      ],
      "bar.ts": [
        'import("https://libs.example.com/lib@3.2.1/mod.js");',
        'import("https://libs.example.com/lib@3.2.1/mod.js");',
      ],
      "foo.js": [
        'import "https://libs.example.com/lib@3.2.1/mod.js";',
        'import "https://libs.example.com/unknown@1.0.0/mod.js";',
      ],
    },
    static: {
      "page.html": [
        '<script src="https://libs.example.com/jquery@3.6.0/dist/jquery.min.js"></script>',
        '<link rel="stylesheet" href="https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css">',
        '<img src="https://cdn.example.com/dist/img/logo.png" alt="Logo">',
      ],
      "style.css": [
        '@import "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css";',
        "header { background-image: url('https://cdn.example.com/dist/img/logo.jpg'); }",
      ],
    },
  },
  errors: Set(1) {
    {
      error: "Fetching https://libs.example.com/unknown/mod.js failed: 404 ",
      filePath: "src/foo.js",
      url: "https://libs.example.com/unknown@1.0.0/mod.js",
    },
  },
  result: {
    updates: Set(8) {
      {
        filePath: "src/App.jsx",
        index: {
          end: 61,
          start: 24,
        },
        location: {
          column: 24,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/react",
          currentUrl: "https://libs.example.com/react@17.0.2",
          currentVersion: {
            index: {
              end: 37,
              start: 30,
            },
            major: 17,
            match: "@17.0.2",
            minor: 0,
            patch: 2,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/react@19.1.1",
          latestVersion: {
            index: {
              end: 37,
              start: 30,
            },
            major: 19,
            match: "@19.1.1",
            minor: 1,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/App.tsx",
        index: {
          end: 62,
          start: 24,
        },
        location: {
          column: 24,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/preact",
          currentUrl: "https://libs.example.com/preact@10.0.0",
          currentVersion: {
            index: {
              end: 38,
              start: 31,
            },
            major: 10,
            match: "@10.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/preact@10.10.10",
          latestVersion: {
            index: {
              end: 40,
              start: 31,
            },
            major: 10,
            match: "@10.10.10",
            minor: 10,
            patch: 10,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
      {
        filePath: "src/bar.ts",
        index: {
          end: 102,
          start: 61,
        },
        location: {
          column: 8,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/bar.ts",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@2.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 2,
            match: "@2.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/foo.js",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 169,
          start: 108,
        },
        location: {
          column: 29,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4.5/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 38,
              start: 34,
            },
            major: 4,
            match: "@4.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 67,
          start: 13,
        },
        location: {
          column: 13,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/jquery/dist/jquery.min.js",
          currentUrl: "https://libs.example.com/jquery@3.5/dist/jquery.min.js",
          currentVersion: {
            index: {
              end: 35,
              start: 31,
            },
            major: 3,
            match: "@3.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/jquery@3.6.0/dist/jquery.min.js",
          latestVersion: {
            index: {
              end: 37,
              start: 31,
            },
            major: 3,
            match: "@3.6.0",
            minor: 6,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
      {
        filePath: "static/style.css",
        index: {
          end: 68,
          start: 9,
        },
        location: {
          column: 9,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 36,
              start: 34,
            },
            major: 4,
            match: "@4",
            minor: null,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
    },
  },
}
`;

snapshot[`finds updates in multiple files 1`] = `
{
  errors: Set(1) {
    {
      error: "Fetching https://libs.example.com/unknown/mod.js failed: 404 ",
      filePath: "src/foo.js",
      url: "https://libs.example.com/unknown@1.0.0/mod.js",
    },
  },
  result: {
    updates: Set(3) {
      {
        filePath: "src/foo.js",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 169,
          start: 108,
        },
        location: {
          column: 29,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4.5/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 38,
              start: 34,
            },
            major: 4,
            match: "@4.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 67,
          start: 13,
        },
        location: {
          column: 13,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/jquery/dist/jquery.min.js",
          currentUrl: "https://libs.example.com/jquery@3.5/dist/jquery.min.js",
          currentVersion: {
            index: {
              end: 35,
              start: 31,
            },
            major: 3,
            match: "@3.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/jquery@3.6.0/dist/jquery.min.js",
          latestVersion: {
            index: {
              end: 37,
              start: 31,
            },
            major: 3,
            match: "@3.6.0",
            minor: 6,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
    },
  },
}
`;

snapshot[`writes updates in multiple files 1`] = `
{
  content: {
    "help.md": [
      "Check out [lib](https://libs.example.com/lib@1.0.0/mod.js).",
    ],
    "help.txt": [
      "Check out https://libs.example.com/lib@1.0.0/mod.js.",
    ],
    "tasks.ini": [
      'start="deno run https://mods.example.com/x/example@v1.2.3/mod.ts"',
    ],
    "tasks.json": [
      '{ "start": "deno run https://mods.example.com/x/example@v1/mod.ts" }',
    ],
    "tasks.yml": [
      "start: deno run https://mods.example.com/x/example@v2/mod.ts",
    ],
    node_modules: {
      "foo.js": [
        'import "https://libs.example.com/lib@1.0.0/mod.js";',
      ],
    },
    src: {
      "App.jsx": [
        'import * as React from "https://libs.example.com/react@17.0.2";',
      ],
      "App.tsx": [
        'import * as React from "https://libs.example.com/preact@10.0.0";',
      ],
      "bar.ts": [
        'import("https://libs.example.com/lib@2.0.0/mod.js");',
        'import("https://libs.example.com/lib@1.0.0/mod.js");',
      ],
      "foo.js": [
        'import "https://libs.example.com/lib@3.2.1/mod.js";',
        'import "https://libs.example.com/unknown@1.0.0/mod.js";',
      ],
    },
    static: {
      "page.html": [
        '<script src="https://libs.example.com/jquery@3.6.0/dist/jquery.min.js"></script>',
        '<link rel="stylesheet" href="https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css">',
        '<img src="https://cdn.example.com/dist/img/logo.png" alt="Logo">',
      ],
      "style.css": [
        '@import "https://libs.example.com/bootstrap@4/dist/bootstrap.min.css";',
        "header { background-image: url('https://cdn.example.com/dist/img/logo.jpg'); }",
      ],
    },
  },
  errors: Set(1) {
    {
      error: "Fetching https://libs.example.com/unknown/mod.js failed: 404 ",
      filePath: "src/foo.js",
      url: "https://libs.example.com/unknown@1.0.0/mod.js",
    },
  },
  result: {
    updates: Set(3) {
      {
        filePath: "src/foo.js",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 169,
          start: 108,
        },
        location: {
          column: 29,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4.5/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 38,
              start: 34,
            },
            major: 4,
            match: "@4.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 67,
          start: 13,
        },
        location: {
          column: 13,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/jquery/dist/jquery.min.js",
          currentUrl: "https://libs.example.com/jquery@3.5/dist/jquery.min.js",
          currentVersion: {
            index: {
              end: 35,
              start: 31,
            },
            major: 3,
            match: "@3.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/jquery@3.6.0/dist/jquery.min.js",
          latestVersion: {
            index: {
              end: 37,
              start: 31,
            },
            major: 3,
            match: "@3.6.0",
            minor: 6,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
    },
  },
}
`;

snapshot[`writes updates with additional extensions specified 1`] = `
{
  content: {
    "help.md": [
      "Check out [lib](https://libs.example.com/lib@3.2.1/mod.js).",
    ],
    "help.txt": [
      "Check out https://libs.example.com/lib@3.2.1/mod.js.",
    ],
    "tasks.ini": [
      'start="deno run https://mods.example.com/x/example@v1.2.3/mod.ts"',
    ],
    "tasks.json": [
      '{ "start": "deno run https://mods.example.com/x/example@v2.0.0/mod.ts" }',
    ],
    "tasks.yml": [
      "start: deno run https://mods.example.com/x/example@v2.0.0/mod.ts",
    ],
    node_modules: {
      "foo.js": [
        'import "https://libs.example.com/lib@1.0.0/mod.js";',
      ],
    },
    src: {
      "App.jsx": [
        'import * as React from "https://libs.example.com/react@19.1.1";',
      ],
      "App.tsx": [
        'import * as React from "https://libs.example.com/preact@10.10.10";',
      ],
      "bar.ts": [
        'import("https://libs.example.com/lib@3.2.1/mod.js");',
        'import("https://libs.example.com/lib@3.2.1/mod.js");',
      ],
      "foo.js": [
        'import "https://libs.example.com/lib@3.2.1/mod.js";',
        'import "https://libs.example.com/unknown@1.0.0/mod.js";',
      ],
    },
    static: {
      "page.html": [
        '<script src="https://libs.example.com/jquery@3.6.0/dist/jquery.min.js"></script>',
        '<link rel="stylesheet" href="https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css">',
        '<img src="https://cdn.example.com/dist/img/logo.png" alt="Logo">',
      ],
      "style.css": [
        '@import "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css";',
        "header { background-image: url('https://cdn.example.com/dist/img/logo.jpg'); }",
      ],
    },
  },
  errors: Set(1) {
    {
      error: "Fetching https://libs.example.com/unknown/mod.js failed: 404 ",
      filePath: "src/foo.js",
      url: "https://libs.example.com/unknown@1.0.0/mod.js",
    },
  },
  result: {
    updates: Set(12) {
      {
        filePath: "help.md",
        index: {
          end: 57,
          start: 16,
        },
        location: {
          column: 16,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "help.txt",
        index: {
          end: 51,
          start: 10,
        },
        location: {
          column: 10,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/App.jsx",
        index: {
          end: 61,
          start: 24,
        },
        location: {
          column: 24,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/react",
          currentUrl: "https://libs.example.com/react@17.0.2",
          currentVersion: {
            index: {
              end: 37,
              start: 30,
            },
            major: 17,
            match: "@17.0.2",
            minor: 0,
            patch: 2,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/react@19.1.1",
          latestVersion: {
            index: {
              end: 37,
              start: 30,
            },
            major: 19,
            match: "@19.1.1",
            minor: 1,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/App.tsx",
        index: {
          end: 62,
          start: 24,
        },
        location: {
          column: 24,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/preact",
          currentUrl: "https://libs.example.com/preact@10.0.0",
          currentVersion: {
            index: {
              end: 38,
              start: 31,
            },
            major: 10,
            match: "@10.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/preact@10.10.10",
          latestVersion: {
            index: {
              end: 40,
              start: 31,
            },
            major: 10,
            match: "@10.10.10",
            minor: 10,
            patch: 10,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
      {
        filePath: "src/bar.ts",
        index: {
          end: 102,
          start: 61,
        },
        location: {
          column: 8,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/bar.ts",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@2.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 2,
            match: "@2.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/foo.js",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 169,
          start: 108,
        },
        location: {
          column: 29,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4.5/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 38,
              start: 34,
            },
            major: 4,
            match: "@4.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 67,
          start: 13,
        },
        location: {
          column: 13,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/jquery/dist/jquery.min.js",
          currentUrl: "https://libs.example.com/jquery@3.5/dist/jquery.min.js",
          currentVersion: {
            index: {
              end: 35,
              start: 31,
            },
            major: 3,
            match: "@3.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/jquery@3.6.0/dist/jquery.min.js",
          latestVersion: {
            index: {
              end: 37,
              start: 31,
            },
            major: 3,
            match: "@3.6.0",
            minor: 6,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
      {
        filePath: "static/style.css",
        index: {
          end: 68,
          start: 9,
        },
        location: {
          column: 9,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 36,
              start: 34,
            },
            major: 4,
            match: "@4",
            minor: null,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "tasks.json",
        index: {
          end: 65,
          start: 21,
        },
        location: {
          column: 21,
          line: 0,
        },
        update: {
          baseUrl: "https://mods.example.com/x/example/mod.ts",
          currentUrl: "https://mods.example.com/x/example@v1/mod.ts",
          currentVersion: {
            index: {
              end: 37,
              start: 34,
            },
            major: 1,
            match: "@v1",
            minor: null,
            patch: null,
            prefix: "v",
            prerelease: null,
          },
          latestUrl: "https://mods.example.com/x/example@v2.0.0/mod.ts",
          latestVersion: {
            index: {
              end: 41,
              start: 34,
            },
            major: 2,
            match: "@v2.0.0",
            minor: 0,
            patch: 0,
            prefix: "v",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "tasks.yml",
        index: {
          end: 60,
          start: 16,
        },
        location: {
          column: 16,
          line: 0,
        },
        update: {
          baseUrl: "https://mods.example.com/x/example/mod.ts",
          currentUrl: "https://mods.example.com/x/example@v2/mod.ts",
          currentVersion: {
            index: {
              end: 37,
              start: 34,
            },
            major: 2,
            match: "@v2",
            minor: null,
            patch: null,
            prefix: "v",
            prerelease: null,
          },
          latestUrl: "https://mods.example.com/x/example@v2.0.0/mod.ts",
          latestVersion: {
            index: {
              end: 41,
              start: 34,
            },
            major: 2,
            match: "@v2.0.0",
            minor: 0,
            patch: 0,
            prefix: "v",
            prerelease: null,
          },
          release: "minor",
        },
      },
    },
  },
}
`;

snapshot[`writes updates with skip paths specified 1`] = `
{
  content: {
    "help.md": [
      "Check out [lib](https://libs.example.com/lib@1.0.0/mod.js).",
    ],
    "help.txt": [
      "Check out https://libs.example.com/lib@1.0.0/mod.js.",
    ],
    "tasks.ini": [
      'start="deno run https://mods.example.com/x/example@v1.2.3/mod.ts"',
    ],
    "tasks.json": [
      '{ "start": "deno run https://mods.example.com/x/example@v2.0.0/mod.ts" }',
    ],
    "tasks.yml": [
      "start: deno run https://mods.example.com/x/example@v2.0.0/mod.ts",
    ],
    node_modules: {
      "foo.js": [
        'import "https://libs.example.com/lib@1.0.0/mod.js";',
      ],
    },
    src: {
      "App.jsx": [
        'import * as React from "https://libs.example.com/react@19.1.1";',
      ],
      "App.tsx": [
        'import * as React from "https://libs.example.com/preact@10.10.10";',
      ],
      "bar.ts": [
        'import("https://libs.example.com/lib@2.0.0/mod.js");',
        'import("https://libs.example.com/lib@1.0.0/mod.js");',
      ],
      "foo.js": [
        'import "https://libs.example.com/lib@1.0.0/mod.js";',
        'import "https://libs.example.com/unknown@1.0.0/mod.js";',
      ],
    },
    static: {
      "page.html": [
        '<script src="https://libs.example.com/jquery@3.6.0/dist/jquery.min.js"></script>',
        '<link rel="stylesheet" href="https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css">',
        '<img src="https://cdn.example.com/dist/img/logo.png" alt="Logo">',
      ],
      "style.css": [
        '@import "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css";',
        "header { background-image: url('https://cdn.example.com/dist/img/logo.jpg'); }",
      ],
    },
  },
  errors: Set(0) {},
  result: {
    updates: Set(7) {
      {
        filePath: "src/App.jsx",
        index: {
          end: 61,
          start: 24,
        },
        location: {
          column: 24,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/react",
          currentUrl: "https://libs.example.com/react@17.0.2",
          currentVersion: {
            index: {
              end: 37,
              start: 30,
            },
            major: 17,
            match: "@17.0.2",
            minor: 0,
            patch: 2,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/react@19.1.1",
          latestVersion: {
            index: {
              end: 37,
              start: 30,
            },
            major: 19,
            match: "@19.1.1",
            minor: 1,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/App.tsx",
        index: {
          end: 62,
          start: 24,
        },
        location: {
          column: 24,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/preact",
          currentUrl: "https://libs.example.com/preact@10.0.0",
          currentVersion: {
            index: {
              end: 38,
              start: 31,
            },
            major: 10,
            match: "@10.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/preact@10.10.10",
          latestVersion: {
            index: {
              end: 40,
              start: 31,
            },
            major: 10,
            match: "@10.10.10",
            minor: 10,
            patch: 10,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 169,
          start: 108,
        },
        location: {
          column: 29,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4.5/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 38,
              start: 34,
            },
            major: 4,
            match: "@4.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 67,
          start: 13,
        },
        location: {
          column: 13,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/jquery/dist/jquery.min.js",
          currentUrl: "https://libs.example.com/jquery@3.5/dist/jquery.min.js",
          currentVersion: {
            index: {
              end: 35,
              start: 31,
            },
            major: 3,
            match: "@3.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/jquery@3.6.0/dist/jquery.min.js",
          latestVersion: {
            index: {
              end: 37,
              start: 31,
            },
            major: 3,
            match: "@3.6.0",
            minor: 6,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
      {
        filePath: "static/style.css",
        index: {
          end: 68,
          start: 9,
        },
        location: {
          column: 9,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 36,
              start: 34,
            },
            major: 4,
            match: "@4",
            minor: null,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "tasks.json",
        index: {
          end: 65,
          start: 21,
        },
        location: {
          column: 21,
          line: 0,
        },
        update: {
          baseUrl: "https://mods.example.com/x/example/mod.ts",
          currentUrl: "https://mods.example.com/x/example@v1/mod.ts",
          currentVersion: {
            index: {
              end: 37,
              start: 34,
            },
            major: 1,
            match: "@v1",
            minor: null,
            patch: null,
            prefix: "v",
            prerelease: null,
          },
          latestUrl: "https://mods.example.com/x/example@v2.0.0/mod.ts",
          latestVersion: {
            index: {
              end: 41,
              start: 34,
            },
            major: 2,
            match: "@v2.0.0",
            minor: 0,
            patch: 0,
            prefix: "v",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "tasks.yml",
        index: {
          end: 60,
          start: 16,
        },
        location: {
          column: 16,
          line: 0,
        },
        update: {
          baseUrl: "https://mods.example.com/x/example/mod.ts",
          currentUrl: "https://mods.example.com/x/example@v2/mod.ts",
          currentVersion: {
            index: {
              end: 37,
              start: 34,
            },
            major: 2,
            match: "@v2",
            minor: null,
            patch: null,
            prefix: "v",
            prerelease: null,
          },
          latestUrl: "https://mods.example.com/x/example@v2.0.0/mod.ts",
          latestVersion: {
            index: {
              end: 41,
              start: 34,
            },
            major: 2,
            match: "@v2.0.0",
            minor: 0,
            patch: 0,
            prefix: "v",
            prerelease: null,
          },
          release: "minor",
        },
      },
    },
  },
}
`;

snapshot[`writes updates with skip paths specified 2`] = `
{
  content: {
    "help.md": [
      "Check out [lib](https://libs.example.com/lib@1.0.0/mod.js).",
    ],
    "help.txt": [
      "Check out https://libs.example.com/lib@1.0.0/mod.js.",
    ],
    "tasks.ini": [
      'start="deno run https://mods.example.com/x/example@v1.2.3/mod.ts"',
    ],
    "tasks.json": [
      '{ "start": "deno run https://mods.example.com/x/example@v2.0.0/mod.ts" }',
    ],
    "tasks.yml": [
      "start: deno run https://mods.example.com/x/example@v2.0.0/mod.ts",
    ],
    node_modules: {
      "foo.js": [
        'import "https://libs.example.com/lib@1.0.0/mod.js";',
      ],
    },
    src: {
      "App.jsx": [
        'import * as React from "https://libs.example.com/react@19.1.1";',
      ],
      "App.tsx": [
        'import * as React from "https://libs.example.com/preact@10.10.10";',
      ],
      "bar.ts": [
        'import("https://libs.example.com/lib@3.2.1/mod.js");',
        'import("https://libs.example.com/lib@3.2.1/mod.js");',
      ],
      "foo.js": [
        'import "https://libs.example.com/lib@3.2.1/mod.js";',
        'import "https://libs.example.com/unknown@1.0.0/mod.js";',
      ],
    },
    static: {
      "page.html": [
        '<script src="https://libs.example.com/jquery@3.5/dist/jquery.min.js"></script>',
        '<link rel="stylesheet" href="https://libs.example.com/bootstrap@4.5/dist/bootstrap.min.css">',
        '<img src="https://cdn.example.com/dist/img/logo.png" alt="Logo">',
      ],
      "style.css": [
        '@import "https://libs.example.com/bootstrap@4/dist/bootstrap.min.css";',
        "header { background-image: url('https://cdn.example.com/dist/img/logo.jpg'); }",
      ],
    },
  },
  errors: Set(1) {
    {
      error: "Fetching https://libs.example.com/unknown/mod.js failed: 404 ",
      filePath: "src/foo.js",
      url: "https://libs.example.com/unknown@1.0.0/mod.js",
    },
  },
  result: {
    updates: Set(7) {
      {
        filePath: "src/App.jsx",
        index: {
          end: 61,
          start: 24,
        },
        location: {
          column: 24,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/react",
          currentUrl: "https://libs.example.com/react@17.0.2",
          currentVersion: {
            index: {
              end: 37,
              start: 30,
            },
            major: 17,
            match: "@17.0.2",
            minor: 0,
            patch: 2,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/react@19.1.1",
          latestVersion: {
            index: {
              end: 37,
              start: 30,
            },
            major: 19,
            match: "@19.1.1",
            minor: 1,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/App.tsx",
        index: {
          end: 62,
          start: 24,
        },
        location: {
          column: 24,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/preact",
          currentUrl: "https://libs.example.com/preact@10.0.0",
          currentVersion: {
            index: {
              end: 38,
              start: 31,
            },
            major: 10,
            match: "@10.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/preact@10.10.10",
          latestVersion: {
            index: {
              end: 40,
              start: 31,
            },
            major: 10,
            match: "@10.10.10",
            minor: 10,
            patch: 10,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
      {
        filePath: "src/bar.ts",
        index: {
          end: 102,
          start: 61,
        },
        location: {
          column: 8,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/bar.ts",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@2.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 2,
            match: "@2.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/foo.js",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "tasks.json",
        index: {
          end: 65,
          start: 21,
        },
        location: {
          column: 21,
          line: 0,
        },
        update: {
          baseUrl: "https://mods.example.com/x/example/mod.ts",
          currentUrl: "https://mods.example.com/x/example@v1/mod.ts",
          currentVersion: {
            index: {
              end: 37,
              start: 34,
            },
            major: 1,
            match: "@v1",
            minor: null,
            patch: null,
            prefix: "v",
            prerelease: null,
          },
          latestUrl: "https://mods.example.com/x/example@v2.0.0/mod.ts",
          latestVersion: {
            index: {
              end: 41,
              start: 34,
            },
            major: 2,
            match: "@v2.0.0",
            minor: 0,
            patch: 0,
            prefix: "v",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "tasks.yml",
        index: {
          end: 60,
          start: 16,
        },
        location: {
          column: 16,
          line: 0,
        },
        update: {
          baseUrl: "https://mods.example.com/x/example/mod.ts",
          currentUrl: "https://mods.example.com/x/example@v2/mod.ts",
          currentVersion: {
            index: {
              end: 37,
              start: 34,
            },
            major: 2,
            match: "@v2",
            minor: null,
            patch: null,
            prefix: "v",
            prerelease: null,
          },
          latestUrl: "https://mods.example.com/x/example@v2.0.0/mod.ts",
          latestVersion: {
            index: {
              end: 41,
              start: 34,
            },
            major: 2,
            match: "@v2.0.0",
            minor: 0,
            patch: 0,
            prefix: "v",
            prerelease: null,
          },
          release: "minor",
        },
      },
    },
  },
}
`;

snapshot[`writes updates with blocked domains specified 1`] = `
{
  content: {
    "help.md": [
      "Check out [lib](https://libs.example.com/lib@1.0.0/mod.js).",
    ],
    "help.txt": [
      "Check out https://libs.example.com/lib@1.0.0/mod.js.",
    ],
    "tasks.ini": [
      'start="deno run https://mods.example.com/x/example@v1.2.3/mod.ts"',
    ],
    "tasks.json": [
      '{ "start": "deno run https://mods.example.com/x/example@v1/mod.ts" }',
    ],
    "tasks.yml": [
      "start: deno run https://mods.example.com/x/example@v2/mod.ts",
    ],
    node_modules: {
      "foo.js": [
        'import "https://libs.example.com/lib@1.0.0/mod.js";',
      ],
    },
    src: {
      "App.jsx": [
        'import * as React from "https://libs.example.com/react@19.1.1";',
      ],
      "App.tsx": [
        'import * as React from "https://libs.example.com/preact@10.10.10";',
      ],
      "bar.ts": [
        'import("https://libs.example.com/lib@3.2.1/mod.js");',
        'import("https://libs.example.com/lib@3.2.1/mod.js");',
      ],
      "foo.js": [
        'import "https://libs.example.com/lib@3.2.1/mod.js";',
        'import "https://libs.example.com/unknown@1.0.0/mod.js";',
      ],
    },
    static: {
      "page.html": [
        '<script src="https://libs.example.com/jquery@3.6.0/dist/jquery.min.js"></script>',
        '<link rel="stylesheet" href="https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css">',
        '<img src="https://cdn.example.com/dist/img/logo.png" alt="Logo">',
      ],
      "style.css": [
        '@import "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css";',
        "header { background-image: url('https://cdn.example.com/dist/img/logo.jpg'); }",
      ],
    },
  },
  errors: Set(1) {
    {
      error: "Fetching https://libs.example.com/unknown/mod.js failed: 404 ",
      filePath: "src/foo.js",
      url: "https://libs.example.com/unknown@1.0.0/mod.js",
    },
  },
  result: {
    updates: Set(8) {
      {
        filePath: "src/App.jsx",
        index: {
          end: 61,
          start: 24,
        },
        location: {
          column: 24,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/react",
          currentUrl: "https://libs.example.com/react@17.0.2",
          currentVersion: {
            index: {
              end: 37,
              start: 30,
            },
            major: 17,
            match: "@17.0.2",
            minor: 0,
            patch: 2,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/react@19.1.1",
          latestVersion: {
            index: {
              end: 37,
              start: 30,
            },
            major: 19,
            match: "@19.1.1",
            minor: 1,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/App.tsx",
        index: {
          end: 62,
          start: 24,
        },
        location: {
          column: 24,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/preact",
          currentUrl: "https://libs.example.com/preact@10.0.0",
          currentVersion: {
            index: {
              end: 38,
              start: 31,
            },
            major: 10,
            match: "@10.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/preact@10.10.10",
          latestVersion: {
            index: {
              end: 40,
              start: 31,
            },
            major: 10,
            match: "@10.10.10",
            minor: 10,
            patch: 10,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
      {
        filePath: "src/bar.ts",
        index: {
          end: 102,
          start: 61,
        },
        location: {
          column: 8,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/bar.ts",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@2.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 2,
            match: "@2.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "src/foo.js",
        index: {
          end: 49,
          start: 8,
        },
        location: {
          column: 8,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/lib/mod.js",
          currentUrl: "https://libs.example.com/lib@1.0.0/mod.js",
          currentVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 1,
            match: "@1.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/lib@3.2.1/mod.js",
          latestVersion: {
            index: {
              end: 34,
              start: 28,
            },
            major: 3,
            match: "@3.2.1",
            minor: 2,
            patch: 1,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 169,
          start: 108,
        },
        location: {
          column: 29,
          line: 1,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4.5/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 38,
              start: 34,
            },
            major: 4,
            match: "@4.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
      {
        filePath: "static/page.html",
        index: {
          end: 67,
          start: 13,
        },
        location: {
          column: 13,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/jquery/dist/jquery.min.js",
          currentUrl: "https://libs.example.com/jquery@3.5/dist/jquery.min.js",
          currentVersion: {
            index: {
              end: 35,
              start: 31,
            },
            major: 3,
            match: "@3.5",
            minor: 5,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/jquery@3.6.0/dist/jquery.min.js",
          latestVersion: {
            index: {
              end: 37,
              start: 31,
            },
            major: 3,
            match: "@3.6.0",
            minor: 6,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "minor",
        },
      },
      {
        filePath: "static/style.css",
        index: {
          end: 68,
          start: 9,
        },
        location: {
          column: 9,
          line: 0,
        },
        update: {
          baseUrl: "https://libs.example.com/bootstrap/dist/bootstrap.min.css",
          currentUrl: "https://libs.example.com/bootstrap@4/dist/bootstrap.min.css",
          currentVersion: {
            index: {
              end: 36,
              start: 34,
            },
            major: 4,
            match: "@4",
            minor: null,
            patch: null,
            prefix: "",
            prerelease: null,
          },
          latestUrl: "https://libs.example.com/bootstrap@5.0.0/bootstrap.min.css",
          latestVersion: {
            index: {
              end: 40,
              start: 34,
            },
            major: 5,
            match: "@5.0.0",
            minor: 0,
            patch: 0,
            prefix: "",
            prerelease: null,
          },
          release: "major",
        },
      },
    },
  },
}
`;

snapshot[`writes updates with blocked domains specified 2`] = `
{
  content: {
    "help.md": [
      "Check out [lib](https://libs.example.com/lib@1.0.0/mod.js).",
    ],
    "help.txt": [
      "Check out https://libs.example.com/lib@1.0.0/mod.js.",
    ],
    "tasks.ini": [
      'start="deno run https://mods.example.com/x/example@v1.2.3/mod.ts"',
    ],
    "tasks.json": [
      '{ "start": "deno run https://mods.example.com/x/example@v1/mod.ts" }',
    ],
    "tasks.yml": [
      "start: deno run https://mods.example.com/x/example@v2/mod.ts",
    ],
    node_modules: {
      "foo.js": [
        'import "https://libs.example.com/lib@1.0.0/mod.js";',
      ],
    },
    src: {
      "App.jsx": [
        'import * as React from "https://libs.example.com/react@17.0.2";',
      ],
      "App.tsx": [
        'import * as React from "https://libs.example.com/preact@10.0.0";',
      ],
      "bar.ts": [
        'import("https://libs.example.com/lib@2.0.0/mod.js");',
        'import("https://libs.example.com/lib@1.0.0/mod.js");',
      ],
      "foo.js": [
        'import "https://libs.example.com/lib@1.0.0/mod.js";',
        'import "https://libs.example.com/unknown@1.0.0/mod.js";',
      ],
    },
    static: {
      "page.html": [
        '<script src="https://libs.example.com/jquery@3.5/dist/jquery.min.js"></script>',
        '<link rel="stylesheet" href="https://libs.example.com/bootstrap@4.5/dist/bootstrap.min.css">',
        '<img src="https://cdn.example.com/dist/img/logo.png" alt="Logo">',
      ],
      "style.css": [
        '@import "https://libs.example.com/bootstrap@4/dist/bootstrap.min.css";',
        "header { background-image: url('https://cdn.example.com/dist/img/logo.jpg'); }",
      ],
    },
  },
  errors: Set(0) {},
  result: {
    updates: Set(0) {},
  },
}
`;
